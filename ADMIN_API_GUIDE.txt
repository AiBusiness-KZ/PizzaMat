# üîß ADMIN API GUIDE - PizzaMat

## üìã OVERVIEW

Backend –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª–Ω—ã–π CRUD API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Å–µ–º–∏ —Å—É—â–Ω–æ—Å—Ç—è–º–∏ —Å–∏—Å—Ç–µ–º—ã.

**Base URL:** `http://localhost:8000`  
**Swagger UI:** http://localhost:8000/docs

---

## üéØ API ENDPOINTS

### 1. CATEGORIES (–ö–∞—Ç–µ–≥–æ—Ä–∏–∏)

#### GET /api/admin/categories
–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–≤–∫–ª—é—á–∞—è –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ)
```bash
curl http://localhost:8000/api/admin/categories
```

#### POST /api/admin/categories
–°–æ–∑–¥–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
```bash
curl -X POST http://localhost:8000/api/admin/categories \
  -F "name=–î–µ—Å–µ—Ä—Ç–∏" \
  -F "description=–°–º–∞—á–Ω—ñ –¥–µ—Å–µ—Ä—Ç–∏" \
  -F "sort_order=4" \
  -F "is_active=true"
```

#### PUT /api/admin/categories/{id}
–û–±–Ω–æ–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
```bash
curl -X PUT http://localhost:8000/api/admin/categories/1 \
  -F "name=–ü—ñ—Ü–∞" \
  -F "description=–û–Ω–æ–≤–ª–µ–Ω–∏–π –æ–ø–∏—Å" \
  -F "sort_order=1" \
  -F "is_active=true"
```

#### DELETE /api/admin/categories/{id}
–£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
```bash
curl -X DELETE http://localhost:8000/api/admin/categories/1
```

---

### 2. PRODUCTS (–ü—Ä–æ–¥—É–∫—Ç—ã)

#### GET /api/admin/products
–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –ø—Ä–æ–¥—É–∫—Ç—ã
```bash
curl http://localhost:8000/api/admin/products
```

#### POST /api/admin/products
–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ç —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
```bash
curl -X POST http://localhost:8000/api/admin/products \
  -F "category_id=1" \
  -F "name=–ß—ñ–∑–∫–µ–π–∫" \
  -F "description=–ù—ñ–∂–Ω–∏–π —á—ñ–∑–∫–µ–π–∫" \
  -F "base_price=95.00" \
  -F "sort_order=0" \
  -F "is_active=true" \
  -F "image=@/path/to/cheesecake.jpg"
```

#### PUT /api/admin/products/{id}
–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç
```bash
curl -X PUT http://localhost:8000/api/admin/products/1 \
  -F "category_id=1" \
  -F "name=–ú–∞—Ä–≥–∞—Ä–∏—Ç–∞" \
  -F "base_price=130.00" \
  -F "is_active=true"
```

#### DELETE /api/admin/products/{id}
–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç
```bash
curl -X DELETE http://localhost:8000/api/admin/products/1
```

---

### 3. LOCATIONS (–¢–æ—á–∫–∏ –≤—ã–¥–∞—á–∏)

#### GET /api/admin/locations
–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –ª–æ–∫–∞—Ü–∏–∏
```bash
curl http://localhost:8000/api/admin/locations
```

#### GET /api/admin/cities
–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –≥–æ—Ä–æ–¥–∞
```bash
curl http://localhost:8000/api/admin/cities
```

#### POST /api/admin/cities
–°–æ–∑–¥–∞—Ç—å –≥–æ—Ä–æ–¥
```bash
curl -X POST http://localhost:8000/api/admin/cities \
  -F "name=–û–¥–µ—Å–∞" \
  -F "is_active=true"
```

#### POST /api/admin/locations
–°–æ–∑–¥–∞—Ç—å —Ç–æ—á–∫—É –≤—ã–¥–∞—á–∏
```bash
curl -X POST http://localhost:8000/api/admin/locations \
  -F "city_id=1" \
  -F "name=–¢–†–¶ –ì–ª–æ–±—É—Å" \
  -F "address=–≤—É–ª. –ú–∞–π–¥–∞–Ω –ù–µ–∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ, 1" \
  -F "working_hours=09:00-22:00" \
  -F "is_active=true"
```

#### PUT /api/admin/locations/{id}
–û–±–Ω–æ–≤–∏—Ç—å –ª–æ–∫–∞—Ü–∏—é
```bash
curl -X PUT http://localhost:8000/api/admin/locations/1 \
  -F "city_id=1" \
  -F "name=–¢–†–¶ –ì–ª–æ–±—É—Å" \
  -F "address=–ù–æ–≤–∏–π –∞–¥—Ä–µ—Å" \
  -F "working_hours=10:00-23:00"
```

#### DELETE /api/admin/locations/{id}
–£–¥–∞–ª–∏—Ç—å –ª–æ–∫–∞—Ü–∏—é
```bash
curl -X DELETE http://localhost:8000/api/admin/locations/1
```

---

### 4. SETTINGS (–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∞–π—Ç–∞)

#### GET /api/admin/settings
–ü–æ–ª—É—á–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```bash
curl http://localhost:8000/api/admin/settings
```

#### PUT /api/admin/settings
–û–±–Ω–æ–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```bash
curl -X PUT http://localhost:8000/api/admin/settings \
  -F "site_name=My PizzaMat" \
  -F "site_description=–õ—É—á—à–∞—è –ø—ñ—Ü–∞ –≤ –º—ñ—Å—Ç—ñ" \
  -F "phone=+380501234567" \
  -F "email=info@pizzamat.com" \
  -F "address=–ö–∏—ó–≤, –≤—É–ª. –•—Ä–µ—â–∞—Ç–∏–∫, 1" \
  -F "bot_token=7123456789:AAHdqTcvCH1vGWJxfSeofSAs0K5PALDsaw" \
  -F "manager_channel_id=-1001234567890" \
  -F "admin_telegram_ids=123456789,987654321" \
  -F "openai_api_key=sk-..." \
  -F "n8n_url=https://n8n.example.com" \
  -F "logo=@/path/to/logo.png"
```

**–ü–æ–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫:**
- `site_name` - –ù–∞–∑–≤–∞–Ω–∏–µ —Å–∞–π—Ç–∞
- `site_logo` - URL –ª–æ–≥–æ—Ç–∏–ø–∞
- `site_description` - –û–ø–∏—Å–∞–Ω–∏–µ
- `phone` - –¢–µ–ª–µ—Ñ–æ–Ω
- `email` - Email
- `address` - –ê–¥—Ä–µ—Å
- `bot_token` - Telegram Bot Token
- `manager_channel_id` - ID –∫–∞–Ω–∞–ª–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
- `admin_telegram_ids` - ID –∞–¥–º–∏–Ω–æ–≤ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)
- `openai_api_key` - OpenAI API Key
- `n8n_url` - URL n8n
- `n8n_webhook_secret` - Webhook secret

---

### 5. ORDERS (–ó–∞–∫–∞–∑—ã)

#### GET /api/admin/orders
–ü–æ–ª—É—á–∏—Ç—å –∑–∞–∫–∞–∑—ã
```bash
# –í—Å–µ –∑–∞–∫–∞–∑—ã
curl http://localhost:8000/api/admin/orders

# –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É
curl "http://localhost:8000/api/admin/orders?status=pending_payment"

# –° –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
curl "http://localhost:8000/api/admin/orders?limit=20&offset=0"
```

**–°—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–æ–≤:**
- `pending_payment` - –û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã
- `paid` - –û–ø–ª–∞—á–µ–Ω
- `preparing` - –ì–æ—Ç–æ–≤–∏—Ç—Å—è
- `ready` - –ì–æ—Ç–æ–≤ –∫ –≤—ã–¥–∞—á–µ
- `completed` - –ó–∞–≤–µ—Ä—à–µ–Ω
- `cancelled` - –û—Ç–º–µ–Ω–µ–Ω

#### PUT /api/admin/orders/{id}/status
–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞
```bash
curl -X PUT http://localhost:8000/api/admin/orders/1/status \
  -F "status=ready"
```

---

### 6. FILE UPLOAD (–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤)

#### POST /api/admin/upload/image
–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
```bash
curl -X POST http://localhost:8000/api/admin/upload/image \
  -F "file=@/path/to/image.jpg"
```

**Response:**
```json
{
  "success": true,
  "data": {
    "url": "/uploads/upload_uuid.jpg",
    "filename": "upload_uuid.jpg"
  }
}
```

---

## üîê –í–ê–ñ–ù–û: –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨

**–í —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –ù–ï–¢ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏!**

### –î–ª—è PRODUCTION –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:

1. **JWT Authentication**
```python
from fastapi import Depends, HTTPException
from app.core.security import get_current_admin_user

@router.post("/categories")
async def create_category(
    ...,
    current_user = Depends(get_current_admin_user)
):
    ...
```

2. **Middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤:**
```python
# app/middleware/auth.py
async def verify_admin(request: Request, call_next):
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∞
    ...
```

3. **Rate Limiting:**
```python
from slowapi import Limiter
limiter = Limiter(key_func=get_remote_address)

@limiter.limit("10/minute")
@router.post("/products")
async def create_product(...):
    ...
```

---

## üìä –ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø

### 1. –ú–∞—Å—Å–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ CSV

```python
import pandas as pd
import requests

df = pd.read_csv('products.csv')

for _, row in df.iterrows():
    # Upload image
    with open(row['image_path'], 'rb') as f:
        img_response = requests.post(
            'http://localhost:8000/api/admin/upload/image',
            files={'file': f}
        )
        image_url = img_response.json()['data']['url']
    
    # Create product
    requests.post(
        'http://localhost:8000/api/admin/products',
        data={
            'category_id': row['category_id'],
            'name': row['name'],
            'description': row['description'],
            'base_price': row['price'],
            'is_active': True
        }
    )
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫

```python
import requests

settings_data = {
    'site_name': 'PizzaMat Ukraine',
    'phone': '+380501234567',
    'email': 'support@pizzamat.ua',
    'bot_token': '7123456:AAHdq...',
    'manager_channel_id': '-1001234567',
    'admin_telegram_ids': '123456,654321'
}

response = requests.put(
    'http://localhost:8000/api/admin/settings',
    data=settings_data
)
print(response.json())
```

### 3. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∑–∞–∫–∞–∑–æ–≤

```python
import requests

# Pending orders
pending = requests.get(
    'http://localhost:8000/api/admin/orders?status=pending_payment'
).json()

print(f"Pending orders: {len(pending['data'])}")

# All orders
all_orders = requests.get(
    'http://localhost:8000/api/admin/orders?limit=1000'
).json()

total_revenue = sum(o['total_amount'] for o in all_orders['data'])
print(f"Total revenue: {total_revenue} UAH")
```

---

## üé® –°–û–ó–î–ê–ù–ò–ï FRONTEND –ê–î–ú–ò–ù–ö–ò

–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è React –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:

### –í–∞—Ä–∏–∞–Ω—Ç 1: React Admin
```bash
npm install react-admin ra-data-simple-rest
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: Refine
```bash
npm create refine-app@latest admin-panel
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: Custom —Å TanStack Table
```bash
npm install @tanstack/react-table @tanstack/react-query axios
```

---

## üìù TODO –¥–ª—è Production

- [ ] –î–æ–±–∞–≤–∏—Ç—å JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
- [ ] Middleware –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤
- [ ] Rate limiting
- [ ] Validation (Pydantic models)
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- [ ] Backup –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º
- [ ] –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- [ ] Batch operations API
- [ ] Export/Import CSV
- [ ] Image optimization (resize, compress)
- [ ] Soft delete –≤–º–µ—Å—Ç–æ hard delete
- [ ] Audit trail (–∫—Ç–æ, –∫–æ–≥–¥–∞ –∏–∑–º–µ–Ω–∏–ª)

---

## üöÄ –ë–´–°–¢–†–´–ô –°–¢–ê–†–¢

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ API:**
```bash
curl http://localhost:8000/health
curl http://localhost:8000/api/admin/categories
```

2. **–°–æ–∑–¥–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é:**
```bash
curl -X POST http://localhost:8000/api/admin/categories \
  -F "name=–¢–µ—Å—Ç–æ–≤–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è" \
  -F "is_active=true"
```

3. **–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ç:**
```bash
curl -X POST http://localhost:8000/api/admin/products \
  -F "category_id=1" \
  -F "name=–¢–µ—Å—Ç–æ–≤–∏–π –ø—Ä–æ–¥—É–∫—Ç" \
  -F "base_price=100" \
  -F "is_active=true"
```

4. **Swagger UI:** http://localhost:8000/docs
   - –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
   - –ú–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ endpoints

---

**API –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üéâ**
